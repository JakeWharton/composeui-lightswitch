buildscript {
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath libs.kotlin.gradlePlugin
	}
}

apply plugin: 'org.jetbrains.kotlin.multiplatform'

kotlin {
	linuxArm64 {
		binaries.executable {
			entryPoint = 'main'

			// Work around https://youtrack.jetbrains.com/issue/KT-48082.
			linkerOpts(
				"-L${file("usr/lib").absolutePath}",
				"-lwayland-client",
			)
		}
		compilations.main.cinterops {
			create("wayland") {
				packageName("wayland")
				includeDirs("usr/include")
				header("usr/include/wayland-client.h")
			}
		}
	}

	sourceSets.configureEach {
		languageSettings.optIn("kotlinx.cinterop.ExperimentalForeignApi")
	}
}
